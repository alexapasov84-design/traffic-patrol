<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Traffic Patrol Online | –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API —Å –≤–∞—à–∏–º –∫–ª—é—á–æ–º -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=365e247d-d853-4425-b9cc-13bfa1169a49&lang=ru_RU" type="text/javascript"></script>
    
    <style>
        /* –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–æ–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è –∫–∞—Ä—Ç–∞ */
        #map {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            background: #0d47a1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .map-loading {
            text-align: center;
            padding: 20px;
        }
        
        .map-loading i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #00bcd4;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∫–ª–∞–º—É –Ø–Ω–¥–µ–∫—Å */
        .ymaps-2-1-79-map-copyrights-promo,
        .ymaps-2-1-79-copyright__content,
        .ymaps-2-1-79-copyright__layout {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –•–µ–¥–µ—Ä -->
        <header class="app-header">
            <div class="header-left">
                <h1><i class="fas fa-map-marked-alt"></i> Traffic Patrol</h1>
                <p class="online-count">
                    <i class="fas fa-users"></i> –û–Ω–ª–∞–π–Ω: <span id="onlineCount">1</span> | 
                    <i class="fas fa-map-marker-alt"></i> –ú–µ—Ç–æ–∫: <span id="markerCount">0</span>
                </p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span id="userName">–ò–≥—Ä–æ–∫</span>
                    <div class="user-rank" id="userRank">–ù–æ–≤–∏—á–æ–∫ üö¶</div>
                </div>
                <button class="btn-location" onclick="centerToUser()" title="–ú–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
                    <i class="fas fa-location-arrow"></i>
                </button>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <!-- –°–µ–∫—Ü–∏—è –∫–∞—Ä—Ç—ã -->
            <div class="map-section">
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã -->
                <div id="map">
                    <div class="map-loading">
                        <i class="fas fa-sync fa-spin"></i>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</p>
                    </div>
                </div>
                
                <!-- –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã -->
                <div class="map-legend">
                    <h3><i class="fas fa-map-signs"></i> –õ–µ–≥–µ–Ω–¥–∞:</h3>
                    <div class="legend-items">
                        <div class="legend-item" onclick="selectTool('police')">
                            <div class="legend-icon police-icon"><i class="fas fa-car"></i></div>
                            <div class="legend-text">
                                <strong>–ü–∞—Ç—Ä—É–ª—å üöì</strong>
                                <small>–ö–ª–∏–∫ - –¥–æ–±–∞–≤–∏—Ç—å, –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</small>
                            </div>
                        </div>
                        <div class="legend-item" onclick="selectTool('accident')">
                            <div class="legend-icon accident-icon"><i class="fas fa-car-crash"></i></div>
                            <div class="legend-text">
                                <strong>–î–¢–ü üí•</strong>
                                <small>–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ 2 —Å–µ–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</small>
                            </div>
                        </div>
                        <div class="legend-item" onclick="selectTool('hazard')">
                            <div class="legend-icon hazard-icon"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="legend-text">
                                <strong>–û–ø–∞—Å–Ω–æ—Å—Ç—å ‚ö†Ô∏è</strong>
                                <small>–Ø–º—ã, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, —Ä–µ–º–æ–Ω—Ç</small>
                            </div>
                        </div>
                        <div class="legend-item" onclick="selectTool('clear')">
                            <div class="legend-icon clear-icon"><i class="fas fa-trash-alt"></i></div>
                            <div class="legend-text">
                                <strong>–£–¥–∞–ª–∏—Ç—å üóëÔ∏è</strong>
                                <small>–ö–ª–∏–∫ –Ω–∞ –º–µ—Ç–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="legend-info">
                        <p><i class="fas fa-info-circle"></i> –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞: 55.459619, 38.438920</p>
                        <p><i class="fas fa-mouse-pointer"></i> –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –º–µ—Ç–∫–∏ –Ω–∞ –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞!</p>
                    </div>
                </div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
            <div class="toolbar">
                <button class="tool-btn active" data-tool="police" onclick="selectTool('police')">
                    <div class="tool-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="tool-info">
                        <span class="tool-name">–ü–∞—Ç—Ä—É–ª—å</span>
                        <span class="tool-cost">-10 –æ—á–∫–æ–≤</span>
                    </div>
                </button>
                
                <button class="tool-btn" data-tool="accident" onclick="selectTool('accident')">
                    <div class="tool-icon">
                        <i class="fas fa-car-crash"></i>
                    </div>
                    <div class="tool-info">
                        <span class="tool-name">–î–¢–ü</span>
                        <span class="tool-cost">-15 –æ—á–∫–æ–≤</span>
                    </div>
                </button>
                
                <button class="tool-btn" data-tool="hazard" onclick="selectTool('hazard')">
                    <div class="tool-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="tool-info">
                        <span class="tool-name">–û–ø–∞—Å–Ω–æ—Å—Ç—å</span>
                        <span class="tool-cost">-8 –æ—á–∫–æ–≤</span>
                    </div>
                </button>
                
                <button class="tool-btn" data-tool="clear" onclick="selectTool('clear')">
                    <div class="tool-icon">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <div class="tool-info">
                        <span class="tool-name">–£–¥–∞–ª–∏—Ç—å</span>
                        <span class="tool-cost">+5 –æ—á–∫–æ–≤</span>
                    </div>
                </button>
                
                <button class="tool-btn" onclick="showChat()" id="chatButton">
                    <div class="tool-icon">
                        <i class="fas fa-comments"></i>
                        <span class="badge" id="chatBadge">0</span>
                    </div>
                    <div class="tool-info">
                        <span class="tool-name">–ß–∞—Ç</span>
                    </div>
                </button>
                
                <button class="tool-btn" onclick="showHelp()">
                    <div class="tool-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="tool-info">
                        <span class="tool-name">–ü–æ–º–æ—â—å</span>
                    </div>
                </button>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="info-panel">
                <div class="info-card">
                    <i class="fas fa-info-circle"></i>
                    <div class="info-content">
                        <h4>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h4>
                        <p>1. <strong>–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</strong> –Ω–∞ –ø–∞–Ω–µ–ª–∏ –≤—ã—à–µ</p>
                        <p>2. <strong>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É</strong> –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∫–∏</p>
                        <p>3. <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –º–µ—Ç–∫—É</strong> –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</p>
                        <p>4. <strong>–í—ã–±–µ—Ä–∏—Ç–µ "–£–¥–∞–ª–∏—Ç—å"</strong> –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</p>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stat-row">
                        <div class="stat-item">
                            <i class="fas fa-coins"></i>
                            <div>
                                <span class="stat-label">–í–∞—à–∏ –æ—á–∫–∏:</span>
                                <span class="stat-value" id="userPoints">100</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-bolt"></i>
                            <div>
                                <span class="stat-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                                <span class="stat-value" id="userActivity">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="pointsProgress" style="width: 100%"></div>
                    </div>
                    <div class="progress-text">–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="progressPercent">100%</span></div>
                </div>
            </div>
        </main>

        <!-- –ß–∞—Ç -->
        <div class="chat-modal" id="chatModal">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> –ß–∞—Ç –ø–∞—Ç—Ä—É–ª—è</h3>
                <button class="close-chat" onclick="hideChat()">&times;</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="system-message">
                    <i class="fas fa-info-circle"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç Traffic Patrol!
                </div>
                <div class="system-message">
                    <i class="fas fa-map-marker-alt"></i> –¢–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞—Ä—Ç—ã: 55.459619, 38.438920
                </div>
                <div class="system-message">
                    <i class="fas fa-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –º–µ—Ç–∫–∏ –Ω–∞ –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞!
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–∞—Ç—Ä—É–ª—é..." maxlength="200">
                <button onclick="sendMessage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <!-- –ü–æ–º–æ—â—å -->
        <div class="help-modal" id="helpModal">
            <div class="help-content">
                <div class="help-header">
                    <h3><i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å –ø–æ –∏–≥—Ä–µ</h3>
                    <button class="close-help" onclick="hideHelp()">&times;</button>
                </div>
                <div class="help-body">
                    <div class="help-section">
                        <h4><i class="fas fa-gamepad"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h4>
                        <ul>
                            <li><strong>–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É:</strong> –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø ‚Üí –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É</li>
                            <li><strong>–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–µ—Ç–∫—É:</strong> –ó–∞–∂–º–∏—Ç–µ –º–µ—Ç–∫—É –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ</li>
                            <li><strong>–£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∫—É:</strong> –í—ã–±–µ—Ä–∏—Ç–µ "–£–¥–∞–ª–∏—Ç—å" ‚Üí –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É</li>
                            <li><strong>–î–¢–ü:</strong> –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–∞–ª–µ—Ü/–º—ã—à—å 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∫–∞—Ä—Ç–µ</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4><i class="fas fa-star"></i> –°–∏—Å—Ç–µ–º–∞ –æ—á–∫–æ–≤:</h4>
                        <ul>
                            <li>–ü–∞—Ç—Ä—É–ª—å: -10 –æ—á–∫–æ–≤</li>
                            <li>–î–¢–ü: -15 –æ—á–∫–æ–≤</li>
                            <li>–û–ø–∞—Å–Ω–æ—Å—Ç—å: -8 –æ—á–∫–æ–≤</li>
                            <li>–£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–∫–∏: +5 –æ—á–∫–æ–≤</li>
                            <li>–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ—Ç–∫–∏: +2 –æ—á–∫–∞</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4><i class="fas fa-trophy"></i> –†–∞–Ω–≥–∏:</h4>
                        <ul>
                            <li>0-99 –æ—á–∫–æ–≤: –ù–æ–≤–∏—á–æ–∫ üö¶</li>
                            <li>100-199 –æ—á–∫–æ–≤: –ü–∞—Ç—Ä—É–ª—å–Ω—ã–π üöì</li>
                            <li>200-499 –æ—á–∫–æ–≤: –û—Ñ–∏—Ü–µ—Ä üöî</li>
                            <li>500-999 –æ—á–∫–æ–≤: –°–µ—Ä–∂–∞–Ω—Ç üëÆ</li>
                            <li>1000+ –æ—á–∫–æ–≤: –ö–æ–º–∏—Å—Å–∞—Ä üëÆ‚Äç‚ôÇÔ∏è</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notificationContainer"></div>
    </div>

    <!-- JavaScript —Ñ–∞–π–ª—ã -->
    <script src="js/app.js"></script>
    <script src="js/yandex-map.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function selectTool(tool) {
            if (window.mapManager) {
                window.mapManager.selectTool(tool);
            } else {
                showNotification('–ö–∞—Ä—Ç–∞ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...', 'warning');
            }
        }
        
        function centerToUser() {
            if (window.mapManager) {
                window.mapManager.centerToUser();
            }
        }
        
        function showChat() {
            if (window.mapManager) {
                window.mapManager.showChat();
            }
        }
        
        function hideChat() {
            if (window.mapManager) {
                window.mapManager.hideChat();
            }
        }
        
        function sendMessage() {
            if (window.mapManager) {
                window.mapManager.sendMessage();
            }
        }
        
        function showHelp() {
            document.getElementById('helpModal').style.display = 'block';
        }
        
        function hideHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }
        
        function showNotification(message, type = 'success') {
            if (window.mapManager && window.mapManager.showNotification) {
                window.mapManager.showNotification(message, type);
            } else {
                // –ü—Ä–æ—Å—Ç–∞—è –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'check-circle'}"></i>
                    ${message}
                `;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#4caf50'};
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    z-index: 10000;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    max-width: 300px;
                `;
                
                document.getElementById('notificationContainer').appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-20px)';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –ø–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∏–∫–æ–Ω–∫—É –≤ —Ç—É–ª–±–∞—Ä–µ
        document.getElementById('chatButton').addEventListener('click', showChat);
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º help –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–∫–Ω–∞
        document.getElementById('helpModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideHelp();
            }
        });
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üö® Traffic Patrol Online –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            console.log('üó∫Ô∏è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API –∫–ª—é—á: 365e247d-d853-4425-b9cc-13bfa1169a49');
            console.log('üìç –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã: 55.459619, 38.438920');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
            setTimeout(() => {
                showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Traffic Patrol! –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É.', 'success');
            }, 1000);
        });
    </script>
</body>
</html>
